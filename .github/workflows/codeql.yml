# Workflow name as shown in the GitHub Actions UI
name: "CodeQL"

# Define when this workflow should run
on:
  # Run CodeQL analysis on every push to the main branch
  push:
    branches: [ "main" ]

  # Run CodeQL analysis for pull requests targeting main
  pull_request:
    branches: [ "main" ]

  # Allow the workflow to be triggered manually from the Actions tab
  workflow_dispatch:

jobs:
  analyze:
    # Job name as displayed in GitHub Actions
    name: Analyze (CodeQL)

    # Use the latest Ubuntu runner provided by GitHub
    runs-on: ubuntu-latest

    # Matrix strategy allows running the same job for multiple languages
    strategy:
      # Do not cancel other matrix jobs if one fails
      fail-fast: false

      matrix:
        # Languages to analyze with CodeQL
        # - "go": analyzes Go source code
        # - "cpp": would analyze C/C++ code (disabled here)
        language: [ "go" ] # , "cpp" ] no build for C code here

    steps:
      # Step 1: Check out the repository so CodeQL can access the source code
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Initialize the CodeQL analysis environment
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v3
        with:
          # Specify which language from the matrix should be analyzed
          languages: ${{ matrix.language }}

          # Optional: You could specify custom query packs here
          # queries: security-and-quality

      # Step 3: Automatically build the project (if applicable)
      #
      # - For Go projects, CodeQL can usually analyze the source without
      #   a traditional build step.
      # - For C/C++ projects, CodeQL attempts to build the code to better
      #   understand compilation units and binaries.
      #
      # If autobuild fails (especially for C/C++), you may need to:
      #   - Remove this step
      #   - Add a manual build command (e.g. make, cmake, etc.)
      - name: Autobuild
        uses: github/codeql-action/autobuild@v3

      # Step 4: Run the CodeQL analysis and upload results to GitHub
      #
      # The findings will appear under:
      #   Security -> Code scanning alerts
      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v3
