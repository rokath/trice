############################
# lychee.toml
#
# Purpose:
#   Lychee configuration for reproducible link checks locally and in CI.
#
# Key principles in this setup:
#   1) Do NOT use regex look-ahead / look-behind (not supported by Lychee).
#   2) Exclude unwanted directories/files via `exclude_path` (regex).
#   3) Check only HTTP(S) links by scheme to avoid failing on local file artifacts.
#   4) Accept HTTP 403 (some sites block automated link checkers).
############################


############################
# Display / Logging
############################

# Log level: "error", "warn", "info", "debug", "trace"
# Use "info" by default, switch to "debug" when troubleshooting.
verbose = "info"

# Disable interactive progress output (cleaner CI logs).
no_progress = false # false=progress bar, true=file list

# Human-readable output for logs.
format = "detailed"


############################
# Request Behavior
############################

# Per-request timeout in seconds.
# Consider increasing if you see frequent timeouts on vendor sites.
timeout = 30

# Maximum number of redirects to follow.
max_redirects = 5

# Retries help with flaky endpoints and transient failures (DNS, CDN, etc.).
max_retries = 2
retry_wait_time = 2

# Check web links AND local file links (including anchors in local Markdown/HTML).
scheme = ["http", "https", "file"]

# Do not enforce HTTPS globally (some sites still legitimately use HTTP).
require_https = false


############################
# Accepted HTTP status codes
############################

# Treat these HTTP status codes as valid.
#
# Why accept 403?
#   Some sites intentionally block bots or require cookies / JS challenges.
#   The link can still be valid for humans, so many teams accept 403.
accept = [
  200, 203, 206,
  301, 302, 303, 307, 308,

  403 # Forbidden (intentionally accepted)
]


############################
# Link exclusions (URLs)
############################

# Exclude URLs from checking (regex-based).
# Use this only if you have known flaky domains or intentionally unreachable links.
exclude = [
  # Local development links in documentation
  "^https?://localhost(:[0-9]+)?",
  "^https://www\\.st\\.com/.*",
  "^https://st\\.com/.*"
]


############################
# Path exclusions (files/directories)
############################

# Exclude paths from being scanned (regex-based).
#
# Regex notes:
#   - "(^|/)" matches either the start of the path or a directory separator
#   - "(/|$)" ensures we match a directory boundary (or end of path)
exclude_path = [
  # Legacy documentation directory (your current pain point)
  "(^|/)docs/_Legacy(/|$)",

  # Exclude "Drivers" directories anywhere under examples/
  # (macOS paths and repo paths are typically normalized with "/")
  "(^|/)examples/.*/Drivers(/|$)",

  # Vendored / third-party content
  "(^|/)third_party(/|$)",

  # Generated artifacts
  "(^|/)dist(/|$)",

  # Git metadata (usually unnecessary, but harmless to exclude explicitly)
  "(^|/)\\.git(/|$)"
]
